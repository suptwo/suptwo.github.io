<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=320,user-scalable=0,init-scale=1" />
<title>无标题文档</title>
<style>
body{font-family: "Helvetica Neue", Helvetica, STHeiTi, sans-serif;color: #000000;font-size: 12px; font-family: 微软雅黑;
	color: #fff;}
body,div,ul,li,h1,input,section{margin:0;padding:0;}
section{display:block;}/*html5*/
input,h1{font-family: inherit;font-weight: normal;}
input{margin:0px;padding:0px;outline:none;border:none; }
input[type="text"]{margin:0px;padding:0px;}
img{border:none;}
ul,li{list-style: none;}
.fl{ float:left;}
.fr{ float:right;}
/*清除浮动*/
.clearfix:before, .clearfix:after { content:"";display: table;}
.clearfix:after{clear:both;	overflow: hidden;}
/*移动端*/
html, body ,input{-webkit-user-select: none;   user-select: none;-webkit-user-drag:none;}/* 禁止选中文本（如无文本选中需求，此为必选项） */
body{-webkit-overflow-scrolling: touch;}
*, ::after, ::before{-webkit-tap-highlight-color: rgba(0,0,0,0);}/*click会出现绑定点击区域闪一下*/
input[type="text"],input[type="password"],input[type="button"],input[type="submit"],select{
	-webkit-appearance:none;
}/*去除input默认样式*/
html, body, div, h1{-webkit-text-size-adjust:none;}/*阻止旋转屏幕时自动调整字体大小*/
img {-webkit-touch-callout: none; }/* 禁止长按链接与图片弹出菜单 */
img{max-width:100%;height:auto;}

.box{  width:320px; margin:0 auto;margin-top:80px;}
.log{ height:30px; width:30px;position:relative; margin-left:10px}
.log span{ position:absolute; top:15px; left:32px; height:0; width:0; line-height:0; border:5px dashed transparent;border-top:5px solid #ccc;}
.log ul{ position:absolute; top:35px; left:0; }
.log li,.log h1{ height:30px; width:30px; background-size:100%; margin-bottom:3px;}
.baidu{ background:url(img/baidulog.jpg) no-repeat center center;}
.q360{ background:url(img/360log.jpg) no-repeat center center;}
.putval{height:30px; margin-left:15px; position:relative;}
.putval .txt1{ border:1px solid #dadada; line-height:12px; height:12px; padding:8px 3px; width:180px; margin-right:3px;}
.searchBtn{line-height:30px; height:30px; text-align:center; width:68px; background:#06F; color:#fff;}

.searchlist{ width:180px; position:absolute; left:0; top:35px;}
.searchlist li{ height:30px; line-height:30px; border-bottom:1px dashed #000; text-indent:10px; color:#222;white-space: nowrap;}
.jsclose{ position:absolute; top:3px; right:10px; background:url(../img/close.png); height:24px; width:24px;z-index:9;display:none;}
</style>
<script>
window.onload=function(){
	var oLog=document.querySelector('.log');
	oLog.bClick=true;
	var oT=document.querySelector('.txt1');
	var oUl=document.querySelector('.searchlist');
	var oBtn=document.querySelector('.searchBtn');
	var oIframe=document.querySelector('iframe');
	var oA=document.querySelector('.jsclose');
	oUl.dis=false;
	oIframe.style.height=window.innerHeight+'px';
	oT.focus();
	oT.onkeyup=function(ev){
		if(oUl.dis){
			oUl.style.display='block';
		}
		var url='';
		var json={};
		var cbName='';
		if(oLog.children[1].className=='q360'){
			url='http://sug.so.360.cn/suggest';
			cbName='callback';
			json={
				'word':oT.value,
			}
			}else{
				cbName:'cb';
				url='http://suggestion.baidu.com/su';
				json={
					wd:oT.value,
				}
			}
		jsonp({
			url:url,
			data:json,
			cbName:cbName,
			success:function(json){
				var arr=json.s;
				oUl.innerHTML='';
				for(var i=0; i<arr.length; i++){
					var oLi=document.createElement('li');
					oLi.innerHTML=arr[i];
					oUl.appendChild(oLi);;
				}
				//加事件
				oUl.addEventListener('touchstart',addTouch,false);
				oUl.clickFn=function(ev){
					var oSrc=ev.srcElement||ev.target;
					if(oSrc.tagName=='LI'){
						oT.value=oSrc.innerHTML;
						oUl.style.display='none';
						oUl.innerHTML='';
						oUl.dis=true;
						oUl.clickFn=null;
					}
				}
			}	
		});
	};
	//关闭按钮
	oA.addEventListener('touchstart',addTouch,false);
	oA.clickFn=function(){
		this.style.display='none';
		oIframe.style.display='none';
		oLog.parentNode.style.display='block';
	}
	
	//触发搜索事件
	oBtn.addEventListener('touchstart',addTouch,false);
	oBtn.clickFn=function(ev){
		oIframe.style.display='block';
		oLog.parentNode.style.display='none';
		oA.style.display='block';
		if(oLog.children[1].className=='q360'){
			oIframe.src='http://www.haosou.com/s?q='+oT.value;
		}else{
			oIframe.src='http://www.baidu.com/s?wd='+oT.value;
		}	
	}
	//搜索引擎切换
	oLog.children[1].addEventListener('touchstart',addTouch,false);
	oLog.children[1].clickFn=function(){
		var _this=this;
		if(oLog.bClick){
			oLog.children[2].style.display='block';
			for(var i=0;i<oLog.children[2].children.length;i++){
				oLog.children[2].children[i].addEventListener('touchstart',addTouch,false);
				oLog.children[2].children[i].clickFn=function(){
					oLog.bClick=true;
					oLog.children[2].style.display='none';
					_this.className=this.className;
					this.clickFn=null;
				};
			}
		}else{
			oLog.children[2].style.display='none';
		}
		oLog.bClick=!oLog.bClick;
	}
};
//jsonp函数
function jsonp(json){
	json=json || {};
	if(!json.url)return;
	json.data=json.data || {};
	json.cbName=json.cbName || 'cb';
	var fnName='jsonp'+Math.random();
	fnName=fnName.replace('.','');	
	window[fnName]=function(data){
		json.success && json.success(data);
		oHead.removeChild(oS);
	};
	json.data[json.cbName]=fnName;
	
	var arr=[];
	for(var name in json.data){
		arr.push(name+'='+json.data[name]);
	}
	var oS=document.createElement('script');
	oS.src=json.url+'?'+arr.join('&');
	var oHead=document.getElementsByTagName('head')[0];
	oHead.appendChild(oS);
}
function addTouch(ev){
	var _this = this;
	//移动距离
	var startX = ev.touches[0].pageX;
	var startY = ev.touches[0].pageY;
	var disX = 0;
	var disY = 0;
	//触摸时间
	var startTime = new Date()*1;
	var endTime = 0;
	var disTime = 0;
	//设置方向
	var direction = 0;
	//判断长按
	_this.bPress = true;
	var timer = setInterval(function(){
		endTime = new Date()*1;
		disTime = endTime - startTime;
		if(disTime>=600){
			if(_this.bPress){
				_this.pressFn && _this.pressFn(ev);
			}
			clearInterval(timer);
		}
	},10); //会有很小的几率出现不是点击，也不是长按
	_this.addEventListener('touchmove',move,false);
	_this.addEventListener('touchend',end,false);
	function move(ev){
		//获取时间差
		endTime = new Date()*1;
		disTime = endTime - startTime;
		//获取空间差
		disX = ev.touches[0].pageX - startX;
		disY = ev.touches[0].pageY - startY;
		//移动时执行函数
		_this.moveFn && _this.moveFn(ev,disX,disY);
		//判断长按
		if(Math.abs(disX) > 2 && Math.abs(disY) > 2){
			_this.bPress = false;
		}
		ev.preventDefault();
	}
	function end(ev){
		endTime = new Date()*1;
		disTime = endTime - startTime;
		direction = getDirection(disX,disY);
		if(disTime < 600){ 
			//获取方向 对应事件
			switch (direction) {
				case 0:
					//点击
					_this.clickFn && _this.clickFn(ev);
					break;
				case 1:
					//向下快滑
					_this.downFn && _this.downFn(ev);
					break;
				case 2:
					//向上快滑
					_this.upFn && _this.upFn(ev);
					break;
				case 3:
					//向左快滑
					_this.leftFn && _this.leftFn(ev);
					break;
				case 4:
					//向左快滑
					_this.rightFn && _this.rightFn(ev);
					break;
				default:
			} 
		}else{
			_this.slowFn && _this.slowFn(ev,disX,disY);
		}
		//事件完成
		_this.completeFn && _this.completeFn(ev,disX,disY);
		//移除事件
		_this.removeEventListener('touchmove',move,false);
		_this.removeEventListener('touchend',end,false);
		//移除定时器
		clearInterval(timer);
		//释放闭包
		end = move = null;
	}
	ev.preventDefault();
}
//返回角度
function getAngle(disX, disY) {
	return Math.atan2(disY, disX) * 180 / Math.PI;
}
//根据起点和终点返回方向 1：向上，2：向下，3：向左，4：向右,0：未滑动
function getDirection(disX,disY) {
	var result = 0;
	//如果滑动距离太短
	if (Math.abs(disX) < 2 && Math.abs(disY) < 2) {
		return result;
	}
	var angle = getAngle(disX, disY);
	if (angle >= -45 && angle < 45) {
		result = 4;
	} else if (angle >= 45 && angle < 135) {
		result = 1;
	} else if (angle >= -135 && angle < -45) {
		result = 2;
	}
	else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
		result = 3;
	}
	return result;
}

</script>
</head>
 
<body>
<section class="box clearfix">
	<!--搜素切换-->
    <section class="log fl">
    	<span></span>
    	<h1 class="baidu"></h1>
        <ul style="display:none">
        	<li class="baidu"></li>
            <li class="q360"></li>
        </ul>
    </section>
    <!--输入框-->
	<section class="putval fl">
    	<input type="text" class="txt1" placeholder="请在这输入你要搜素的内容"/>
    	<input type="botton" class="searchBtn" value="搜素"/>
        <ul class="searchlist">
   		</ul>
    </section>
</section>
<iframe width="100%" height="100%" frameborder="0" style="display:none;"></iframe> 
<a href="javascript:;" class="jsclose"></a>
</body>
</html>
