(function(){var oCon=document.getElementById('con');var oScore=document.getElementById('score');var chessboard=[{'x':8,'y':8,'on':0},{'x':86,'y':8,'on':0},{'x':164,'y':8,'on':0},{'x':242,'y':8,'on':0},{'x':8,'y':86,'on':0},{'x':86,'y':86,'on':0},{'x':164,'y':86,'on':0},{'x':242,'y':86,'on':0},{'x':8,'y':164,'on':0},{'x':86,'y':164,'on':0},{'x':164,'y':164,'on':0},{'x':242,'y':164,'on':0},{'x':8,'y':242,'on':0},{'x':86,'y':242,'on':0},{'x':164,'y':242,'on':0},{'x':242,'y':242,'on':0}];var chessman1=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];var chessman2=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];var count=0;var lock=false;addNum();var keycode=-1;document.addEventListener('touchstart',addTouch,false);document.downFn=function(){keycode=40;movegogo(keycode);};document.upFn=function(){keycode=38;movegogo(keycode);};document.rightFn=function(){keycode=39;movegogo(keycode);};document.leftFn=function(){keycode=37;movegogo(keycode);};function movegogo(keycode){var chessboard=getGroup(keycode);if(chessboard==null){return};if(lock){return};lock=true;var add=false;for(var i=0;i<4;i++){add=ComputMovePosition(chessboard[i])||add};var fnAdd=null;if(add){fnAdd=addNum};move(fnAdd)};function getGroup(key){var arr=null;switch(key){case 37:arr=[[0,1,2,3],[4,5,6,7],[8,9,10,11],[12,13,14,15]];break;case 38:arr=[[0,4,8,12],[1,5,9,13],[2,6,10,14],[3,7,11,15]];break;case 39:arr=[[3,2,1,0],[7,6,5,4],[11,10,9,8],[15,14,13,12]];break;case 40:arr=[[12,8,4,0],[13,9,5,1],[14,10,6,2],[15,11,7,3]];break};return arr};function isGameOver(fn){var arr=[37,38,39,40];var add=false;for(var i=0;i<4;i++){var arr2=getGroup(arr[i]);for(var j=0;j<4;j++){if(isComputMove(arr2[j])){return}}};fn()};function isComputMove(arr){for(var i=1;i<4;i++){for(var j=i;j>0;j--){var this_index=arr[j];var prev_index=arr[j-1];if(chessman1[this_index]==null)break;if(chessman2[prev_index]!=null){break}else if(chessman1[prev_index]==null){return true}else if(chessman1[prev_index].innerHTML==chessman1[this_index].innerHTML){return true}}};return false};function ComputMovePosition(arr){var moveTag=false;for(var i=1;i<4;i++){for(var j=i;j>0;j--){var this_index=arr[j];var prev_index=arr[j-1];if(chessman1[this_index]==null)break;if(chessman2[prev_index]!=null){break}else if(chessman1[prev_index]==null){chessman1[prev_index]=chessman1[this_index];chessman1[this_index]=null;chessboard[prev_index]['on']=chessboard[this_index]['on'];chessboard[this_index]['on']=0;moveTag=true}else if(chessman1[prev_index].innerHTML==chessman1[this_index].innerHTML){chessman2[prev_index]=chessman1[this_index];chessman1[this_index]=null;chessboard[prev_index]['on']*=2;chessboard[this_index]['on']=0;count--;reScore(chessboard[prev_index]['on']);moveTag=true}}};return moveTag};function move(fn){var ai=0;for(var i=0;i<16;i++){if(chessman1[i]!=null&&chessman2[i]!=null){ai++;animal(chessman1[i],{'left':chessboard[i].x,'top':chessboard[i].y},function(){moveOver(--ai,fn)});animal(chessman2[i],{'left':chessboard[i].x,'top':chessboard[i].y});var num=chessboard[i]['on'];chessman2[i].parentNode.removeChild(chessman2[i]);chessman2[i]=null;chessman1[i].innerHTML=num==4?'4':num;chessman1[i].className='num n'+num;continue};if(chessman1[i]!=null){ai++;animal(chessman1[i],{'left':chessboard[i].x,'top':chessboard[i].y},function(){moveOver(--ai,fn)})};if(chessman2[i]!=null){ai++;animal(chessman2[i],{'left':chessboard[i].x,'top':chessboard[i].y},function(){moveOver(--ai,fn)})}}};function moveOver(ai,fn){if(ai==0){if(fn){fn()}else{lock=false}}};var scoreCount=0;function reScore(score){scoreCount+=parseInt(score);oScore.innerHTML=scoreCount};function addNum(){var rdm=parseInt(Math.random()*(16-count));var i=0;for(var index in chessboard){if(chessboard[index].on==0){if(i++==rdm){oDiv=document.createElement("div");oDiv.className='num n2';oDiv.style.left=chessboard[index].x+10+'px';oDiv.style.top=chessboard[index].y+10+'px';oDiv.style.width=60+'px';oDiv.style.height=60+'px';oCon.appendChild(oDiv);chessman1[index]=oDiv;animal(chessman1[index],{'width':70,'height':70,'left':chessboard[index].x,'top':chessboard[index].y},function(){if(count==16){isGameOver(function(){alert('GameOver');console.log('123');lock=true})};lock=false});oDiv.innerHTML='2';chessboard[index].on=2;count++;break}}}};function animal(obj,json,fn){clearInterval(obj.timer);obj.timer=setInterval(function(){var stop=true;for(var name in json){var cur=0;if('opacity'==name){cur=Math.round(getStyle(obj,name)*100)}else{cur=parseInt(getStyle(obj,name))};if(json[name]==cur){continue};var speet=(json[name]-cur)/3;speet=speet>0?Math.ceil(speet):Math.floor(speet);if('opacity'==name){obj.style.filter='alpha(opacity:'+(cur+speet)+')';obj.style.opacity=(cur+speet)/100}else{obj.style[name]=cur+speet+'px'};stop=false};if(stop){if(fn){fn()};clearInterval(obj.timer)}},5)};function getStyle(obj,name){if(obj.currentStyle){var style=obj.currentStyle[name];return style=='auto'?0:style}else{return getComputedStyle(obj,false)[name]}}})();		